checks for gold_fact_transactions:
  # Schema validation
  - schema:
      fail when required column missing:
        - transaction_key
        - doc_id
        - member_key
        - asset_key
        - transaction_date
        - transaction_type
        - amount_midpoint
      fail when wrong type:
        transaction_key: integer
        member_key: integer
        asset_key: integer
        amount_midpoint: decimal

  # Uniqueness
  - duplicate_count(transaction_key) = 0:
      name: Transaction keys must be unique

  # Referential integrity
  - values in (member_key) must exist in gold_dim_member (member_key):
      name: Must reference valid member dimension

  - invalid_count(member_key) where member_key = -1 < 5%:
      name: Less than 5% unknown members

  # Data validity
  - invalid_count(amount_midpoint) = 0:
      valid min: 0
      valid max: 50000000
      name: Midpoint amounts are realistic

  - amount_midpoint = (amount_low + amount_high) / 2:
      name: Midpoint correctly calculated

  # Completeness
  - missing_count(transaction_date) = 0:
      name: All transactions must have dates

  - missing_count(ticker) < 20%:
      name: Most transactions have tickers

  # Freshness
  - freshness(etl_timestamp) < 12h:
      name: Gold layer updated within 12 hours

  # Row count validation
  - row_count >= 100000:
      name: Fact table has sufficient data

  # Anomaly detection
  - anomaly score for row_count < 3:
      name: Daily row count is normal

  - anomaly score for avg(amount_midpoint) < 3:
      name: Average trade size is normal
