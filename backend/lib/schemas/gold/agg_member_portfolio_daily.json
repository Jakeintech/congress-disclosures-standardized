{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "agg_member_portfolio_daily",
  "description": "Daily portfolio snapshots showing cumulative positions over time",
  "type": "object",
  "table_metadata": {
    "grain": "One row per member per asset per day",
    "partitioning": ["year(date_key)", "month(date_key)"],
    "clustering": ["member_key", "asset_key"],
    "update_frequency": "daily"
  },
  "properties": {
    "member_key": {"type": "integer", "minimum": 1},
    "asset_key": {"type": "integer", "minimum": 1},
    "date_key": {"type": "integer", "minimum": 20080101, "maximum": 20301231},
    "total_transactions": {"type": "integer", "minimum": 0},
    "total_purchases": {"type": "integer", "minimum": 0},
    "total_sales": {"type": "integer", "minimum": 0},
    "purchase_volume_low": {"type": "integer", "minimum": 0},
    "purchase_volume_high": {"type": "integer", "minimum": 0},
    "sale_volume_low": {"type": "integer", "minimum": 0},
    "sale_volume_high": {"type": "integer", "minimum": 0},
    "net_position_change_low": {"type": "integer", "description": "purchases - sales"},
    "net_position_change_high": {"type": "integer", "description": "purchases - sales"},
    "estimated_current_position_low": {"type": "integer", "minimum": 0},
    "estimated_current_position_high": {"type": "integer", "minimum": 0},
    "last_transaction_date": {"type": "string", "format": "date"},
    "last_transaction_type": {"type": "string", "enum": ["Purchase", "Sale", "Partial Sale", "Exchange"]}
  },
  "required": [
    "member_key", "asset_key", "date_key", "total_transactions",
    "total_purchases", "total_sales", "estimated_current_position_low",
    "estimated_current_position_high"
  ]
}
